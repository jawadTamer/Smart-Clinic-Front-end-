<div class="appointments-container">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>calendar_today</mat-icon>
        My Appointments
      </h1>
      <button
        mat-raised-button
        color="primary"
        (click)="refreshAppointments()"
        [disabled]="loading"
        class="refresh-btn"
      >
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading your appointments...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <h3>Error Loading Appointments</h3>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshAppointments()">
      <mat-icon>refresh</mat-icon>
      Try Again
    </button>
  </div>

  <!-- Empty State -->
  <div
    *ngIf="!loading && !error && appointments.length === 0"
    class="empty-state"
  >
    <mat-icon class="empty-icon">event_busy</mat-icon>
    <h3>No Appointments Found</h3>
    <p>You don't have any appointments scheduled yet.</p>
  </div>

  <!-- Appointments List -->
  <div
    *ngIf="!loading && !error && appointments.length > 0"
    class="appointments-grid"
  >
    <mat-card *ngFor="let appointment of appointments" class="appointment-card">
      <mat-card-header>
        <div mat-card-avatar class="appointment-avatar">
          <mat-icon [class]="'status-' + appointment.status">
            {{ getStatusIcon(appointment.status) }}
          </mat-icon>
        </div>
        <mat-card-title>
          Dr. {{ appointment.doctor.user.first_name }}
          {{ appointment.doctor.user.last_name }}
        </mat-card-title>
        <mat-card-subtitle>
          {{ appointment.doctor.specialization }}
        </mat-card-subtitle>
        <div class="appointment-actions">
          <mat-chip [color]="getStatusColor(appointment.status)" selected>
            {{ appointment.status | titlecase }}
          </mat-chip>
        </div>
      </mat-card-header>

      <mat-card-content>
        <div class="appointment-details">
          <div class="detail-item">
            <mat-icon class="detail-icon">calendar_today</mat-icon>
            <div class="detail-content">
              <strong>Date:</strong>
              <span>{{ formatDate(appointment.appointment_date) }}</span>
            </div>
          </div>

          <div class="detail-item">
            <mat-icon class="detail-icon">access_time</mat-icon>
            <div class="detail-content">
              <strong>Time:</strong>
              <span>{{ formatTime(appointment.appointment_time) }}</span>
            </div>
          </div>

          <div class="detail-item" *ngIf="appointment.reason">
            <mat-icon class="detail-icon">description</mat-icon>
            <div class="detail-content">
              <strong>Reason:</strong>
              <span>{{ appointment.reason }}</span>
            </div>
          </div>

          <div class="detail-item" *ngIf="appointment.doctor.user.phone">
            <mat-icon class="detail-icon">phone</mat-icon>
            <div class="detail-content">
              <strong>Doctor's Phone:</strong>
              <span>{{ appointment.doctor.user.phone }}</span>
            </div>
          </div>

          <div class="detail-item">
            <mat-icon class="detail-icon">email</mat-icon>
            <div class="detail-content">
              <strong>Doctor's Email:</strong>
              <span>{{ appointment.doctor.user.email }}</span>
            </div>
          </div>

          <div class="detail-item" *ngIf="appointment.notes">
            <mat-icon class="detail-icon">note</mat-icon>
            <div class="detail-content">
              <strong>Notes:</strong>
              <span>{{ appointment.notes }}</span>
            </div>
          </div>

          <div class="detail-item">
            <mat-icon class="detail-icon">schedule</mat-icon>
            <div class="detail-content">
              <strong>Created:</strong>
              <span>{{ formatDate(appointment.created_at) }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions
        align="end"
        *ngIf="
          appointment.status !== 'cancelled' &&
          appointment.status !== 'completed'
        "
      >
        <button
          mat-button
          color="warn"
          (click)="cancelAppointment(appointment.id)"
          [disabled]="loading"
        >
          <mat-icon>cancel</mat-icon>
          Cancel Appointment
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
